import type {NextPage} from "next";
import React, {useState} from "react";
import Head from "next/head";
import raw_data from "public/data/usa-delta-prevalence.csv";
import _ from "lodash";
import {Box} from "@chakra-ui/react";
import {ChoroplethMap, Header, PageLayout, Timeline} from "src/components";
import {processRawData, processMapVizData} from "src/helpers/data";

const Home: NextPage = () => {
  // Represents the position in the data that is currently on display.
  const [currentIndex, setCurrentIndex] = useState(0);

  // Shape raw data.
  const {data} = processRawData(raw_data);

  // Viz specific data.
  const vizData = processMapVizData(data);
  console.log(data);
  return (
    <div>
      <Head>
        <title>Delta Prevalence in USA</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main>
        <PageLayout>
          <Header />
          <Box m={4}>
            <ChoroplethMap data={vizData[currentIndex]} />
            <Timeline
              label={data[currentIndex].date}
              min={0}
              max={data.length - 1}
              defaultValue={currentIndex}
              setCurrentIndex={setCurrentIndex}
            />
          </Box>
        </PageLayout>
      </main>
    </div>
  );
};

export default Home;
